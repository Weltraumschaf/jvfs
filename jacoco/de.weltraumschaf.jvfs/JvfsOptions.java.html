<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>JvfsOptions.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JVFS</a> &gt; <a href="index.html" class="el_package">de.weltraumschaf.jvfs</a> &gt; <span class="el_source">JvfsOptions.java</span></div><h1>JvfsOptions.java</h1><pre class="source lang-java linenums">/*
 *  LICENSE
 *
 * &quot;THE BEER-WARE LICENSE&quot; (Revision 43):
 * &quot;Sven Strittmatter&quot; &lt;weltraumschaf@googlemail.com&gt; wrote this file.
 * As long as you retain this notice you can do whatever you want with
 * this stuff. If we meet some day, and you think this stuff is worth it,
 * you can buy me a non alcohol-free beer in return.
 *
 * Copyright (C) 2012 &quot;Sven Strittmatter&quot; &lt;weltraumschaf@googlemail.com&gt;
 */
package de.weltraumschaf.jvfs;

import java.util.Collections;
import java.util.Map;
import java.util.Objects;

/**
 * Holds options of a JVFS file system.
 *
 * To create options use the builder:&lt;br/&gt;
 * &lt;code&gt;
 final JvfsOptions opts = JvfsOptions.builder()
      .readonly(true)
      .capacity(&quot;1k&quot;)
      .identifier(&quot;a name&quot;)
      .create();
 &lt;/code&gt;
 *
 * @author Sven Strittmatter &lt;weltraumschaf@googlemail.com&gt;
 */
public final class JvfsOptions {

    /**
     * Default options.
     */
<span class="fc" id="L37">    public static final JvfsOptions DEFAULT = builder().create();</span>
    /**
     * Holds the options.
     */
    private final Map&lt;String, ?&gt; env;

    /**
     * Dedicated constructor.
     *
     * @param env must not be {@literal null}
     */
    JvfsOptions(final Map&lt;String, ?&gt; env) {
<span class="fc" id="L49">        super();</span>
<span class="fc" id="L50">        JvfsAssertions.notNull(env, &quot;env&quot;);</span>
<span class="fc" id="L51">        this.env = env;</span>
<span class="fc" id="L52">    }</span>

    /**
     * Get the options as map.
     *
     * @return never {@literal null}
     */
    public Map&lt;String, ?&gt; getEnv() {
<span class="fc" id="L60">        return Collections.unmodifiableMap(env);</span>
    }

    @Override
    public int hashCode() {
<span class="fc" id="L65">        return env.hashCode();</span>
    }

    @Override
    public boolean equals(final Object obj) {
<span class="fc bfc" id="L70" title="All 2 branches covered.">        if (!(obj instanceof JvfsOptions)) {</span>
<span class="fc" id="L71">            return false;</span>
        }

<span class="fc" id="L74">        final JvfsOptions other = (JvfsOptions) obj;</span>
<span class="fc" id="L75">        return env.equals(other.env);</span>
    }

    @Override
    public String toString() {
<span class="fc" id="L80">        final StringBuilder buffer = new StringBuilder(getClass().getSimpleName() + &quot;{&quot;);</span>
<span class="fc" id="L81">        boolean first = true;</span>

<span class="fc bfc" id="L83" title="All 2 branches covered.">        for (final Map.Entry&lt;String, ?&gt; entry : env.entrySet()) {</span>
<span class="fc bfc" id="L84" title="All 2 branches covered.">            if (!first) {</span>
<span class="fc" id="L85">                buffer.append(&quot;, &quot;);</span>
            }

<span class="fc" id="L88">            buffer.append(entry.getKey()).append(&quot;=&quot;).append(Objects.toString(entry.getValue()));</span>
<span class="fc" id="L89">            first = false;</span>
<span class="fc" id="L90">        }</span>

<span class="fc" id="L92">        buffer.append('}');</span>
<span class="fc" id="L93">        return buffer.toString();</span>
    }

    /**
     * Creates new builder.
     *
     * @return never {@literal null}, always new instance
     */
    public static Builder builder() {
<span class="fc" id="L102">        return new Builder();</span>
    }

    /**
     * Creates options by a hash map.
     *
     * @param env must not be {@literal null}
     * @return never {@literal null}
     */
    public static JvfsOptions forValue(final Map&lt;String, ?&gt; env) {
<span class="fc" id="L112">        return new JvfsOptions(env);</span>
    }

    /**
     * Option which indicates if the file system is readonly or not.
     *
     * @return by default {@literal false}
     */
    public boolean isReadonly() {
<span class="fc bfc" id="L121" title="All 2 branches covered.">        if (env.containsKey(Option.READONLY.key)) {</span>
<span class="fc" id="L122">            final Object value = env.get(Option.READONLY.key);</span>

<span class="fc bfc" id="L124" title="All 2 branches covered.">            if (value instanceof String) {</span>
<span class="fc" id="L125">                return Boolean.valueOf((String) value);</span>
<span class="fc bfc" id="L126" title="All 2 branches covered.">            } else if (value instanceof Boolean) {</span>
<span class="fc" id="L127">                return (Boolean) value;</span>
            } else {
<span class="fc" id="L129">                throw new IllegalArgumentException(Objects.toString(value));</span>
            }

        }

<span class="fc" id="L134">        return Builder.DEFAULT_READONLY;</span>
    }

    /**
     * Get the capacity of the file system.
     *
     * @return never {@literal null}, {@link JvfsQuantity#EMPTY} by default
     */
    public JvfsQuantity getCapacity() {
<span class="fc bfc" id="L143" title="All 2 branches covered.">        if (env.containsKey(Option.CAPACITY.key)) {</span>
<span class="fc" id="L144">            final Object value = env.get(Option.CAPACITY.key);</span>

<span class="fc bfc" id="L146" title="All 2 branches covered.">            if (value instanceof JvfsQuantity) {</span>
<span class="fc" id="L147">                return (JvfsQuantity) value;</span>
<span class="fc bfc" id="L148" title="All 2 branches covered.">            } else if (value instanceof String) {</span>
<span class="fc" id="L149">                return JvfsQuantity.forValue((String) value);</span>
<span class="fc bfc" id="L150" title="All 2 branches covered.">            } else if (value instanceof Long) {</span>
<span class="fc" id="L151">                return JvfsQuantity.forValue((Long) value);</span>
            } else {
<span class="fc" id="L153">                throw new IllegalArgumentException(Objects.toString(value));</span>
            }
        }

<span class="fc" id="L157">        return Builder.DEFAULT_CAPACITY;</span>
    }

    /**
     * Get the id of the file system.
     *
     * @return never {@literal null}, empty string by default
     */
    public String identifier() {
<span class="fc bfc" id="L166" title="All 2 branches covered.">        if (env.containsKey(Option.ID.key)) {</span>
<span class="fc" id="L167">            return Objects.toString(env.get(Option.ID.key));</span>
        }

<span class="fc" id="L170">        return Builder.DEFAULT_ID;</span>
    }

    /**
     * Builder to create options.
     */
    public static final class Builder {

        /**
         * Default value for capacity option.
         */
<span class="fc" id="L181">        private static final JvfsQuantity DEFAULT_CAPACITY = JvfsQuantity.EMPTY;</span>
        /**
         * Default value for readonly option.
         */
        private static final boolean DEFAULT_READONLY = false;
        /**
         * Default value for identifier option.
         */
        private static final String DEFAULT_ID = &quot;&quot;;
        /**
         * Capacity for created options.
         */
<span class="fc" id="L193">        private JvfsQuantity capacity = DEFAULT_CAPACITY;</span>
        /**
         * Readonly flag for created options.
         */
<span class="fc" id="L197">        private boolean readOnly = DEFAULT_READONLY;</span>
        /**
         * Id for created options.
         */
<span class="fc" id="L201">        private String identifier = DEFAULT_ID;</span>

        /**
         * Use {@link JvfsOptions#builder()} to get instance.
         */
        private Builder() {
<span class="fc" id="L207">            super();</span>
<span class="fc" id="L208">        }</span>

        /**
         * Set the capacity.
         *
         * @param qunatity see {@link JvfsQuantity#forValue(java.lang.String)}
         * @return builder itself
         */
        public Builder capacity(final String qunatity) {
<span class="fc" id="L217">            capacity = JvfsQuantity.forValue(qunatity);</span>
<span class="fc" id="L218">            return this;</span>
        }

        /**
         * Set the readonly flag.
         *
         * @param flag {@literal true} for readonly file system, else {@literal false}
         * @return builder itself
         */
        public Builder readonly(final boolean flag) {
<span class="fc" id="L228">            readOnly = flag;</span>
<span class="fc" id="L229">            return this;</span>
        }

        /**
         * Set the capacity.
         *
         * @param id must not be {@code null}
         * @return builder itself
         */
        public Builder identifier(final String id) {
<span class="fc" id="L239">            JvfsAssertions.notNull(id, &quot;id&quot;);</span>
<span class="fc" id="L240">            this.identifier = id;</span>
<span class="fc" id="L241">            return this;</span>
        }

        /**
         * Create a new options instance.
         *
         * If you call this method without setting any option by {@link #capacity(java.lang.String)} or
         * {@link #readonly(boolean)} then an instance equal to {@link JvfsOptions#DEFAULT} will be created.
         *
         * @return never {@literal null}, always new instance
         */
        public JvfsOptions create() {
<span class="fc" id="L253">            final Map&lt;String, Object&gt; env = JvfsCollections.newMap();</span>
<span class="fc" id="L254">            env.put(Option.CAPACITY.key, capacity);</span>
<span class="fc" id="L255">            env.put(Option.READONLY.key, readOnly);</span>
<span class="fc" id="L256">            env.put(Option.ID.key, identifier);</span>
<span class="fc" id="L257">            return new JvfsOptions(env);</span>
        }
    }

    /**
     * Keys for environment map.
     *
     * You can create options like this:&lt;br/&gt;
     * &lt;code&gt;
     * final Map&amp;lt;String, ?&amp;gt; map = new HashMap&amp;lt;String, ?&amp;gt;();
     * map.put(JvfsOption.Option.CAPACITY.key(), &quot;12M&quot;);
     * map.put(JvfsOption.Option.READONLY.key(), true);
     * // ...
     * final JvfsOption opts = JvfsOption.forValue(map);
     * &lt;/code&gt;
     */
<span class="pc bpc" id="L273" title="1 of 2 branches missed.">    public enum Option {</span>

        /**
         * Key for capacity.
         */
<span class="fc" id="L278">        CAPACITY(&quot;capacity&quot;),</span>
        /**
         * Key for readonly flag.
         */
<span class="fc" id="L282">        READONLY(&quot;readonly&quot;),</span>
        /**
         * Key for identifier.
         */
<span class="fc" id="L286">        ID(&quot;id&quot;);</span>
        /**
         * The key for the map.
         */
        private final String key;

        /**
         * Dedicated constructor.
         *
         * @param key must not be {@literal null} or empty
         */
<span class="fc" id="L297">        Option(final String key) {</span>
<span class="pc bpc" id="L298" title="2 of 4 branches missed.">            assert null != key : &quot;key must be specified&quot;;</span>
<span class="pc bpc" id="L299" title="2 of 4 branches missed.">            assert !key.isEmpty() : &quot;key must not be empty&quot;;</span>
<span class="fc" id="L300">            this.key = key;</span>
<span class="fc" id="L301">        }</span>

        /**
         * Get the key.
         *
         * @return never {@literal null} or empty
         */
        public String key() {
<span class="fc" id="L309">            return key;</span>
        }

    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.3.201306030806</span></div></body></html>